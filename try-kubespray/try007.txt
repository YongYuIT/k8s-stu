https://www.kubernetes.org.cn/5012.html

ip: 192.168.186.131
全部在root环境下

192.168.186.164

cat /etc/hosts
192.168.186.131   K8s

sed -i 's/SELINUX=*/SELINUX=disabled/' /etc/selinux/config
systemctl disable firewalld && systemctl stop firewalld
swapoff -a && echo "vm.swappiness=0" >> /etc/sysctl.conf && sysctl -p && free –h
iptables -P FORWARD ACCEPT

ssh-keygen -t rsa -N ""
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
yum --enablerepo=elrepo-kernel install -y kernel-lt kernel-lt-devel
grub2-set-default 0
reboot

vim /etc/sysctl.conf
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-ip6tables = 1
sysctl -p

yum -y install epel-release
yum clean all && yum makecache
yum install -y python-pip python34 python-netaddr python34-pip ansible git
git clone https://github.com/kubernetes-sigs/kubespray
cd kubespray
pip install -r requirements.txt

cp -rfp inventory/sample inventory/mycluster
vim inventory/mycluster/hosts.ini
[all]
k8s ansible_host=k8s ip=172.16.0.180
[kube-master]
k8s
[etcd]
k8s
[kube-node]
k8s
[k8s-cluster:children]
kube-master
kube-node
[calico-rr]

vim inventory/mycluster/group_vars/all/all.yml
loadbalancer_apiserver_localhost: true
kubelet_load_modules: true

vim ./roles/kubernetes-apps/ansible/templates/dashboard.yml.j2

vim ./roles/kubernetes-apps/ansible/templates/coredns-deployment.yml.j2

ansible-playbook -i inventory/mycluster/hosts.ini cluster.yml -b -v -k
